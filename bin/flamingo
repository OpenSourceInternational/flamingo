#!/usr/bin/env php
<?php

if (file_exists(__DIR__ . '/../autoload.php')) {
    require_once __DIR__ . '/../autoload.php';
} elseif (file_exists(__DIR__ . '/../vendor/autoload.php')) {
    require_once __DIR__ . '/../vendor/autoload.php';
} elseif (file_exists(__DIR__ . '/../../../autoload.php')) {
    require_once __DIR__ . '/../../../autoload.php';
}

// Create command controller and register options
$command = new \Commando\Command();

$command
    ->option('v')
    ->aka('version')
    ->describedAs('Output version information and exit.')
    ->boolean();

$command
    ->option('d')
    ->aka('debug')
    ->describedAs('Output debug information.')
    ->boolean();

$command
    ->option('f')
    ->aka('force')
    ->describedAs('Force execution of the tasks on error.')
    ->boolean();

$command
    ->option()
    ->describedAs('Name of the task file to execute.');

$flamingo = new \Flamingo\Flamingo();

// Output executable version
if ($command['version']) {
    echo $flamingo->getVersion() . PHP_EOL;
    exit;
}

// Register error handler
$handler = \Flamingo\Service\ErrorHandler::init($command['debug'], $command['force']);
\Analog\Analog::handler($handler);

// Forward arguments to the task
$arguments = $command->getArgumentValues();
$taskName = array_shift($arguments);
$flamingo->run($taskName, $arguments);
